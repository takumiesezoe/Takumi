<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Takumi‚Äôs Garden ‚Äî √çndice</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{--bg:#0a0a0a;--card:#131016;--ink:#f5f3f7;--muted:#b9a8ba;--accent:#d36ea6;--garnet:#8b1e3f;--line:#241a24}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{max-width:980px;margin:42px auto;padding:0 18px}
  .card{background:linear-gradient(180deg,rgba(139,30,63,.08),transparent 60%),var(--card);border:1px solid var(--line);border-radius:18px;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  h1{margin:0 0 6px;font-size:clamp(22px,4vw,34px)}
  .muted{color:var(--muted)}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:10px 0 14px}
  input[type="search"]{flex:1;min-width:200px;background:#0f0b10;border:1px solid var(--line);color:var(--ink);padding:12px 14px;border-radius:12px;font-size:15px}
  select{background:#0f0b10;border:1px solid var(--line);color:var(--ink);padding:10px 12px;border-radius:10px}
  .badge{font-size:12px;color:#f1ddea;background:#2a1824;border:1px solid #442034;padding:3px 8px;border-radius:999px}
  ul.list{list-style:none;margin:0;padding:0;display:grid;gap:10px}
  .item{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .item a.main{display:inline-block;padding:12px 14px;border:1px solid var(--line);border-radius:12px;background:#0f0b10;text-decoration:none;color:var(--ink)}
  .item a.main:hover{border-color:var(--accent);box-shadow:0 0 0 3px rgba(211,110,166,.18)}
  .viewer{margin-top:18px;padding:22px;border:1px solid var(--line);border-radius:16px;background:#0f0b10}
  .back{display:inline-block;margin-bottom:14px;text-decoration:none;color:var(--accent)}
  .poem h2{margin:0 0 8px;font-size:clamp(20px,3.5vw,28px)}
  .small{font-size:12px;color:var(--muted)}
  .err{color:#ff8aa8}
</style>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>üóÇÔ∏è √çndice de poemas</h1>
    <p id="status" class="muted">Cargando‚Ä¶</p>

    <div class="row">
      <input id="q" type="search" placeholder="Buscar t√≠tulo‚Ä¶" />
      <select id="sort">
        <option value="local">Seg√∫n esta lista</option>
        <option value="az">T√≠tulo A‚ÜíZ</option>
        <option value="za">T√≠tulo Z‚ÜíA</option>
      </select>
      <span id="count" class="badge">0</span>
    </div>

    <ul id="lista" class="list"></ul>

    <div id="viewer" class="viewer" hidden>
      <a href="#" id="back" class="back">‚Üê Volver al √≠ndice</a>
      <div id="note" class="poem"></div>
    </div>
  </div>
</div>

<script>
  // Carpeta real de tus poemas (confirmada)
  const baseFolder = "Escritos/Canciones-poemas-escritos/Canciones poemas escritos";

  // üîí Modo sin √≠ndice (evita INDEX_404). Edita esta lista cuando a√±adas/renombres poemas:
  const LOCAL_LINKS = [
    "Siempre","Abuelo","Notificaciones","Inconsciente","Escribo","Falta","Hospital",
    "Why is it like this","Creencias","Sound","Kintsugi","Ganas","Este chico","Magnifico",
    "No estoy a la altura","Scars","Body","My big dream","Delirios en la ducha","Pastis","Basura",
    "Escenarios","Eli x2","Delgado","Porro","Me ha dado miedo","Repito","No es justo","In the neck",
    "Indicaciones","Alcohol","Sombras","Aphantasia","¬øPara que","Duele","Envejecer","Same thing",
    "No entiendo","Terapeuta virtual","Perdido","Alone","El lastimado","Mi cerebro","Afilado",
    "Me volvieron a dejar","Random vent","Llanto","Vacio","SHP.com","Casi lo hago","Cronico",
    "En que piensas","Todo","Disposable","Calladito","Todo mal","Borroso","Waking up or falling down",
    "Escapulas","En la sien","3 en ralla","Tik tok curse","Creo que tengo tlp","Mala hija","Padres",
    "Las veces que he despertado","Slit","Irrealidad","Redentor en ruinas","Mi deseo","TEA","Seen","Sex"
  ];

  // Markdown: respeta saltos de l√≠nea para poes√≠a
  marked.setOptions({ breaks:true });

  const $status=document.getElementById("status"),
        $list=document.getElementById("lista"),
        $count=document.getElementById("count"),
        $q=document.getElementById("q"),
        $sort=document.getElementById("sort"),
        $viewer=document.getElementById("viewer"),
        $note=document.getElementById("note"),
        $back=document.getElementById("back");

  const escapeHtml = s => s.replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));

  function cleanNote(md, fallbackTitle){
    md = md.replace(/^---[\s\S]*?---\s*/,'').replace(/^\{[\s\S]*?\}\s*/,'').trim();
    const m = md.match(/^\s*#\s+(.+?)\s*$/m);
    const title = m ? m[1].trim() : fallbackTitle;
    if(m){ md = (md.slice(0,m.index) + md.slice(m.index + m[0].length)).trimStart(); }
    return { title, body: md };
  }

  function sortItems(items, mode){
    const arr = [...items];
    if(mode==="az") arr.sort((a,b)=>a.title.localeCompare(b.title,'es',{sensitivity:'base'}));
    else if(mode==="za") arr.sort((a,b)=>b.title.localeCompare(a.title,'es',{sensitivity:'base'}));
    // "local": mantiene el orden de esta lista
    return arr;
  }

  function renderList(items){
    $count.textContent = items.length;
    const mode = $sort.value;
    const q = $q.value.toLowerCase();
    const toShow = sortItems(items, mode).filter(x=>x.title.toLowerCase().includes(q));
    $list.innerHTML = toShow.map(r=>{
      const url = encodeURI(`notes/${baseFolder}/${r.target}.md`);
      return `<li class="item">
        <a href="#" class="main" data-url="${url}" data-title="${escapeHtml(r.title)}">${escapeHtml(r.title)}</a>
      </li>`;
    }).join("");
    $list.querySelectorAll("a.main").forEach(a=>{
      a.addEventListener("click",ev=>{
        ev.preventDefault();
        openNote(a.dataset.url, a.dataset.title);
      });
    });
  }

  function openNote(url, fallbackTitle){
    const controller = new AbortController();
    const t = setTimeout(()=>controller.abort(), 10000);
    $viewer.hidden=false; $note.innerHTML="<p class='muted'>Cargando‚Ä¶</p>";
    fetch(url,{signal:controller.signal})
      .then(res=>{clearTimeout(t); if(!res.ok) throw new Error(`HTTP ${res.status}`); return res.text();})
      .then(md=>{
        const {title, body} = cleanNote(md, fallbackTitle);
        $note.innerHTML = `<h2>${escapeHtml(title)}</h2><hr />${marked.parse(body)}`;
        $note.scrollIntoView({behavior:"smooth"});
      })
      .catch(err=>{
        clearTimeout(t);
        $note.innerHTML=`<p class="err">‚ùå No se pudo abrir el poema.</p>
                         <p class="small">Error: <code>${(err&&err.message)||err}</code></p>
                         <p class="small">URL: <code>${url}</code></p>`;
      });
  }

  function main(){
    $status.textContent = "‚úÖ Usando lista local";
    const links = LOCAL_LINKS.map((name,i)=>({target:name,title:name,index:i}));
    renderList(links);
    $q.addEventListener("input",()=>renderList(links));
    $sort.addEventListener("change",()=>renderList(links));
  }

  document.getElementById("back").addEventListener("click",e=>{
    e.preventDefault(); $viewer.hidden=true; window.scrollTo({top:0,behavior:"smooth"});
  });

  main();
</script>
</body>
</html>
